/*! calendar tianxiangbing 2015-03-14 */
function Calendar(){this.monthArr=["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],this.dayArr=["日","一","二","三","四","五","六"];var a=Math.random().toString().replace(".","");this.id="calendar_"+a,this.calendarContainer,this.settings={},this.isShow=!1}Calendar.prototype={separator:"-",defaultDate:new Date,setRange:function(a){this.range=$.extend([null,null],a)},init:function(a){if($("body").append('<div class="ui-calendar" id="'+this.id+'"><div class="ui-calendar-pannel" data-role="pannel"><span class="ui-calendar-control" data-role="prev-year">&lt;&lt;</span><span class="ui-calendar-control" data-role="prev-month">&lt;</span><span class="ui-calendar-control month" data-role="current-month"></span><span class="ui-calendar-control year" data-role="current-year"></span><span class="ui-calendar-control" data-role="next-month">&gt;</span><span class="ui-calendar-control" data-role="next-year">&gt;&gt;</span></div><div class="calendar-header"></div><div class="c_days"></div></div>'),this.calendarContainer=$("#"+this.id),this.settings=$.extend({},this.settings,a),this.settings.target&&$(this.settings.target).size()&&(this.settings.focusDate=1===$(this.settings.target)[0].nodeType?this.settings.focusDate||$(this.settings.target).val():this.settings.focusDate||$(this.settings.target).prev().val()||""),this.settings.focusDate){var b=this.settings.focusDate.split(this.separator);this.defaultDate=new Date(b[0],parseInt(b[1])-1,b[2])}this.date=this.defaultDate,this.setRange(this.settings.range),this.formatDate(),this.renderHeader(),this.bindEvent(),this.settings.target?this.hide():this.show()},show:function(){this.calendarContainer.show(),this.isShow=!0,this.setPosition(),this.settings.show&&this.settings.show(this.calendarContainer)},hide:function(){this.calendarContainer.hide(),this.isShow=!1,this.settings.hide&&this.settings.hide(this.calendarContainer)},setPosition:function(){var a=0,b=0;this.settings.target&&$(this.settings.target).size()&&(1===$(this.settings.target)[0].nodeType?(b=$(this.settings.target).offset().top+$(this.settings.target).outerHeight(),a=$(this.settings.target).offset().left):(b=$(this.settings.target).prev().offset().top+$(this.settings.target).prev().outerHeight(),a=$(this.settings.target).prev().offset().left),this.calendarContainer.css({top:b,left:a}))},bindEvent:function(){var a=this;$(".ui-calendar-control[data-role]",a.calendarContainer).click(function(){return a.go[$(this).data("role")].call(a),!1}),$(a.calendarContainer).click(function(){return!1}),$(".c_days",a.calendarContainer).delegate("li","click",function(){if(a.settings.beforeSelect&&a.settings.beforeSelect(a.date,a.calendarContainer),$(this).hasClass("disabled"))return!1;var b=$(this).data("value"),c=b.split(a.separator);return a.defaultDate=new Date(c[0],parseInt(c[1])-1,c[2]),a.date=a.defaultDate,a.formatDate(),a.renderHeader(),a.settings.selected&&a.settings.selected(a.date,a.calendarContainer),a.settings.target&&$(a.settings.target).size()&&1===$(a.settings.target)[0].nodeType&&($(a.settings.target).val(b),a.hide()),!1}),a.settings.target&&($(a.settings.target).bind("click",function(){return a.show(),!1}),$(document).click(function(){a.isShow&&a.hide()}))},go:{"next-month":function(){this.month+=1,this._getDate(),this.formatDate(),this.renderHeader()},"prev-month":function(){this.month-=1,this.changeDate()},"next-year":function(){this.year+=1,this.changeDate()},"prev-year":function(){this.year-=1,this.changeDate()}},changeDate:function(){this._getDate(),this.formatDate(),this.renderHeader()},renderHeader:function(){$('[data-role="current-month"]',this.calendarContainer).html(this.monthArr[this.month]),$('[data-role="current-year"]',this.calendarContainer).html(this.year);for(var a="",b=0,c=this.dayArr.length;c>b;b++)a+="<b>"+this.dayArr[b]+"</b>";$(".calendar-header",this.calendarContainer).html(a)},_getDate:function(){this.date=new Date(this.year,this.month,this.day)},formatDate:function(){var a=this.date;this.year=a.getFullYear(),this.month=a.getMonth(),this.day=a.getDate();var b=new Date(this.year,this.month+1,0),c=b.getDate(),d="<ul>",e=new Date(this.year,this.month,1).getDay(),f=new Date(this.year,this.month,0),g=f.getDate(),h=new Date(this.year,this.month+2,0);e>0&&(d+=this._getDay(g-e+1,g,"preday",f)),d+=this._getDay(1,c,"",this.date);var i=new Date(this.year,this.month,c).getDay();d+=this._getDay(1,6-i,"nextday",h),d+="</ul>",$("#"+this.id).find(".c_days").html(d)},_getDay:function(a,b,c,d){var e="",f=this.range[0],g=this.range[1];f&&(f=Date.parse(f)),g&&(g=Date.parse(g));for(var h=a;b>=h;h++){var i=c||"",j=d.getFullYear()+this.separator+this._getTowNum(d.getMonth()+1)+this.separator;j+=this._getTowNum(h);var k=new Date(d.getFullYear(),d.getMonth(),h),l=k.getTime();l==this.defaultDate.getTime()&&(i+=" focus"),(f&&f>l||g&&l>g)&&(i+=" disabled"),e+='<li class="'+i+'" data-value="'+j+'">'+h+"</li>"}return e},_getTowNum:function(a){return("0"+a.toString()).substr(-2)}};